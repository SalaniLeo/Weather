<!DOCTYPE html>
<html>
    <head>
        <title>Sat24 Europe</title>
    </head>

    <body bgcolor="#000000" leftmargin="0" topmargin="0">
        <img alt="meteosat" src="http://sat24.com/image2.ashx?region=eu&ir=true" border="0"> 
    </body>
</html>



<script language="JavaScript">
    var cell=-1;
    var num = 8

    load()

    function load ( ) {

        aImage= new Array (8)
        aTime= new Array (8)

        data = new Date();
        ora = data.getUTCHours();
        minuti = data.getUTCMinutes();
        mese = data.getUTCMonth()+1;
        giorno = data.getUTCDate();
        anno = data.getFullYear();

        if (minuti < 15)
        {
        minuti = "00";
        }
        else if ((15 <= minuti)&&(minuti < 30))
        {
        minuti = "15";
        }
        else if ((30 <= minuti)&&(minuti < 45))
        {
        minuti = "30";
        }
        else
        {
        minuti = "45";
        }

        if (mese < 10)
        {
        mese = "0" + mese;
        }
        else
        {
        mese = mese;
        }



        if(giorno<10){
            giorno = "0" + giorno
        }


        ora1 = ora;
        ora2 = ora - 1;
        ora3 = ora - 2;



        if (minuti < 15){
            minuti = "00";
        }
        else if ((15 <= minuti)&&(minuti < 30)){
            minuti = "15";
        }
        else if ((30 <= minuti)&&(minuti < 45)){
            minuti = "30";
        }
        else{
            minuti = "45";
        }

        if(minuti < 15){
            ora = ora - 1
        }
        
        let ore = [ora-2, ora-1, ora]

        let minutes = getMins()
        let cnt = 0;
        for(let i = 0; i < num; i++){
            aTime[i]= 400 

            getOre = (i) => {
                if(parseInt(minutes[i]) == 0){
                    cnt = cnt + 1
                }

                return ore[cnt]
            }; 

            aImage[i] = new Image()
            img = new String("http://sat24.com/image2.ashx?region=eu&ir=true&time=" + anno + mese + giorno + getOre(i) + "" + minutes[i]);
            aImage[i].src = img
        }

        ani ();
    }

    function getMins(){
        let minutes = []
        let mins = minuti
        for(let i = 0; i < num; i++){
            minutes.push(mins)
            if(mins < 45){
                mins = parseInt(mins) + 15
            } else {
                mins = "00"
            }
        }
        return minutes;
    }

    var cnt= 7;

    var i=0
    function ani () {
        cell=cell+1;
        if (cell==0) setTimeout ("ani ()",aTime[cell]);
        else if (cell >0 && cell <= cnt) {
            console.log(aImage[cell].src)
            document.images[i].src=aImage[cell].src;
            setTimeout ("ani ()",aTime[cell]);
           }
        else if (cell >cnt) {
            document.images[i].src=aImage[0].src;
            cell=-1;
            ani ();
        }
    }
</script>